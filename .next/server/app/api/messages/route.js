"use strict";(()=>{var e={};e.id=217,e.ids=[217],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5528:e=>{e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},1877:e=>{e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},5319:e=>{e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},4300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},2361:e=>{e.exports=require("events")},7147:e=>{e.exports=require("fs")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},1808:e=>{e.exports=require("net")},2037:e=>{e.exports=require("os")},1017:e=>{e.exports=require("path")},5477:e=>{e.exports=require("punycode")},2781:e=>{e.exports=require("stream")},4404:e=>{e.exports=require("tls")},7310:e=>{e.exports=require("url")},9796:e=>{e.exports=require("zlib")},1441:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>g,originalPathname:()=>h,requestAsyncStorage:()=>p,routeModule:()=>d,serverHooks:()=>m,staticGenerationAsyncStorage:()=>l,staticGenerationBailout:()=>x});var s={};t.r(s),t.d(s,{DELETE:()=>DELETE,GET:()=>GET,PATCH:()=>PATCH,POST:()=>POST});var o=t(884),a=t(6132),i=t(6434);let n=(0,i.eI)("https://gypuyrltfdfkljphihxr.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd5cHV5cmx0ZmRma2xqcGhpaHhyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzA3MDYzMjgsImV4cCI6MjA0NjI4MjMyOH0.5HGDhUdSMo-6ZojHhfIKw_QiPBjXxXVMji2ogL66LEQ");var u=t(5798),c=t(4596);async function getMessages(){let{data:e,error:r}=await n.from("messages").select("*").order("created_at",{ascending:!0});if(r)throw console.error("Error fetching messages:",r),r;return e?.map(e=>({id:e.id,content:e.content,author:e.author,position:{x:e.position_x,y:e.position_y},createdAt:new Date(e.created_at).getTime(),color:e.color,ownerId:e.owner_id,messageNumber:e.message_number}))??[]}async function GET(){let e=(0,c.headers)();e.get("referer");let r=u.Z.json(await getMessages());return r.headers.set("Cache-Control","s-maxage=1, stale-while-revalidate"),r}async function POST(e){try{let r=await e.json(),t={id:r.id,content:r.content,author:r.author,position_x:Math.round(r.position.x),position_y:Math.round(r.position.y),created_at:new Date().toISOString(),color:r.color,owner_id:r.ownerId,message_number:r.messageNumber};console.log("Attempting to insert message:",t);let{data:s,error:o}=await n.from("messages").insert([t]).select().single();if(o)return console.error("Supabase error:",o),u.Z.json({error:"Failed to save message",details:o.message},{status:500});if(!s)return u.Z.json({error:"Failed to save message",details:"No data returned from database"},{status:500});let a={id:s.id,content:s.content,author:s.author,position:{x:s.position_x,y:s.position_y},createdAt:new Date(s.created_at).getTime(),color:s.color,ownerId:s.owner_id,messageNumber:s.message_number};return u.Z.json(a)}catch(e){return console.error("Failed to save message:",e),u.Z.json({error:"Failed to save message",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function PATCH(e){try{let{messageId:r,userId:t,updates:s}=await e.json(),{data:o,error:a}=await n.from("messages").select().eq("id",r).single();if(a)throw a;if(o.owner_id!==t)return u.Z.json({error:"Unauthorized"},{status:403});let{data:i,error:c}=await n.from("messages").update(s).eq("id",r).select().single();if(c)throw c;return u.Z.json(i)}catch(e){return u.Z.json({error:"Failed to update message"},{status:500})}}async function DELETE(e){try{let{messageId:r,userId:t}=await e.json(),{data:s,error:o}=await n.from("messages").select().eq("id",r).single();if(o)throw o;if(s.owner_id!==t)return u.Z.json({error:"Unauthorized"},{status:403});let{error:a}=await n.from("messages").delete().eq("id",r);if(a)throw a;return u.Z.json({success:!0})}catch(e){return u.Z.json({error:"Failed to delete message"},{status:500})}}let d=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/messages/route",pathname:"/api/messages",filename:"route",bundlePath:"app/api/messages/route"},resolvedPagePath:"C:\\Users\\Raj\\wallofadvice\\src\\app\\api\\messages\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:p,staticGenerationAsyncStorage:l,serverHooks:m,headerHooks:g,staticGenerationBailout:x}=d,h="/api/messages/route"}};var r=require("../../../webpack-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),t=r.X(0,[221,520,500,542,155],()=>__webpack_exec__(1441));module.exports=t})();